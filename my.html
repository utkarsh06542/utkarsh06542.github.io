<html>
	<head>
		<title>
			Utkarsh
		</title>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin=""/>

		<!-- Make sure you put this AFTER Leaflet's CSS -->
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>
		<script src="jquery.min.js"></script>
		<style>

			html, body{
			    height: 100%;
			    margin:0;
			}
			#beginscene {
				display:block;
				position:absolute;
				margin: 0 auto;
				padding:0px;
				width: 100%;
				height:100%;
				background-color:#c5dbe0;
				z-index:10;
			  	/*overflow: hidden;*/
			}
			#playbtn {
				position:absolute;
				margin: 0 auto;
				left:50%;
				top:50%;
				transform: translate(-50%, -50%);
				width: 14vmin;
				height: 14vmin;
				z-index:15;
				cursor:pointer;	
			}
			#map { 
				display:block;
				position: absolute;
				margin: 0 auto;
				left:50%;
				top:50%;
				transform: translate(-50%, -50%);
				width: 100%;
				height: 100%;
				z-index: 5;
			}
			#questionarea{
				display: none;
				position: absolute;
				bottom:0px;
				left:0px;
				width: 100%;
				height: 7%;
				background-color:white;
				z-index: 20;
			}
			#questiontext{
				position: absolute;
				left:50%;
				top: 50%;
				transform: translate(-50%,-50%);
				font-family :"Arial Black", Gadget, sans-serif;
				font-size:4vmin;
			}
			
		</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	</head>
	<body>

		<div id="beginscene">
			<div id="playbtn">
				<svg viewBox="0 0 26 26">
				  <polygon class="play-btn__svg" points="9.33 6.69 9.33 19.39 19.3 13.04 9.33 6.69"/>
				  <path class="play-btn__svg" d="M26,13A13,13,0,1,1,13,0,13,13,0,0,1,26,13ZM13,2.18A10.89,10.89,0,1,0,23.84,13.06,10.89,10.89,0,0,0,13,2.18Z"/>
				</svg> 
			</div>
		</div>

		
		<div id="map"></div>
		<div id="questionarea">
			<b><span id="questiontext">My question</span></b>
		</div>
		<script>

			var bounds = [[0,0], [1000,1000]];
			var image1 = L.imageOverlay('india_auto_x2.png', bounds);
			var image2 = L.imageOverlay('india.jpg', bounds);

			var map = L.map('map', {
			    crs: L.CRS.Simple,
			    minZoom: 0,
			    maxZoom: 2,
			    layers: [image2, image1]
			});

			map.fitBounds(bounds);



			var sol = L.latLng([ 330, 150 ]);
			L.marker(sol).addTo(map).bindPopup('Mumbai');

			var southWest = L.latLng(0,0),
			northEast = L.latLng(1000, 1000);
			var bounds = L.latLngBounds(southWest, northEast);

			map.setMaxBounds(bounds);
			map.on('drag', function() {
			    map.panInsideBounds(bounds, { animate: true });
			});

			// function onEachFeature(feature, layer) {
			//     // does this feature have a property named popupContent?
			//     if (feature.properties && feature.properties.popupContent) {
			//         layer.bindPopup(feature.properties.popupContent);
			//     }
			// }

			function onClick(e) {
			    alert(this.getLatLng());
			}

			var layerGroup = L.featureGroup();


			// function onEachFeatureFunction(feature,layer) {
			// 	layerGroup.addLayer(layer);
			// 	layer.on('click', function (e) {
			//       console.log(feature.properties.name);
			//     });
			// }

			var geojsonFeature = {
			    "type": "FeatureCollection",
			    "features":[
			    	{
			    		"type":"Feature",
					    "geometry": {
					        "type": "Point",
					        "coordinates": [300,300]
					    },
					    "properties": {
					        "name": "Bokaro",
					        "popupContent": "This is where I live!"
					    },
			    	},
			    	{
			    		"type":"Feature",
					    "geometry": {
					        "type": "Point",
					        "coordinates": [400,400]
					    },
					    "properties": {
					        "name": "Patna",
					        "popupContent": "This is where I go!"
					    },
			    	}
			    ]
			};


			let out = geojsonFeature.features.reduce((acc, {properties}) =>
			{
			    Object.entries(properties).forEach(([key, val]) =>
			    {
			        acc[key] = acc[key] || new Set();
			        acc[key].add(val);
			    });

			    return acc;
			}, {});

			console.log(Array.from(out["name"]));

			L.geoJSON(geojsonFeature, {
			    onEachFeature: onEachFeatureFunction
			});

			var baseMaps = {
				"Streets": image2,
			    "Grayscale": image1,
			};

			L.control.layers(baseMaps, {
				"Cities": layerGroup.addTo(map)
			}).addTo(map);

			map.panTo(new L.LatLng(400, 400));

			map.on("click", function(e){
				layerGroup.addLayer(new L.Marker([e.latlng.lat, e.latlng.lng]));
				var place_name = prompt("Please enter the name", "");
				console.log("{\"type\":\"Feature\",\n\"geometry\": {\"type\": \"Point\",\"coordinates\": ["+e.latlng.lat+","+e.latlng.lng+"]},\n\"properties\": {\"name\": \""+place_name+"\"}}");
			});


			function shuffle(array) {
			  var currentIndex = array.length, temporaryValue, randomIndex;
			   // Fisher-Yates (aka Knuth) Shuffle
			  // While there remain elements to shuffle...
			  while (0 !== currentIndex) {

			    // Pick a remaining element...
			    randomIndex = Math.floor(Math.random() * currentIndex);
			    currentIndex -= 1;

			    // And swap it with the current element.
			    temporaryValue = array[currentIndex];
			    array[currentIndex] = array[randomIndex];
			    array[randomIndex] = temporaryValue;
			  }

			  return array;
			};

			function blink_text(){
			   $('#questiontext').fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(200, function() {
					// $('#quesmark').addClass('blink_me');
				});
			};

			var currentQuestion=0;
			var questionListLength;
			var questionList = shuffle(Array.from(out["name"]));
			var questionListLength = questionList.length;
			var correctTally=0;
			var wrongAttempts=0;

			$("#playbtn").click(function(){
				// console.log(questionList[0]);
				$('#questionarea').css('display','block');
			    $('#beginscene').fadeOut(250, function() {
					$('#map').css('display','block');
					let currentq = questionList[currentQuestion];
					$('#questiontext').text(currentq);	
					blink_text();
					// startTimer();
					// totlen = myQuiz.questionList.length;
					// $('#score').text('0 / '+totlen);
				});
			});

			function onEachFeatureFunction(feature,layer) {
				layerGroup.addLayer(layer);
				layer.on('click', function (e) {
					var choice = feature.properties.name;
					if (choice === questionList[currentQuestion]){
						currentQuestion++;
						correctTally++;
						wrongAttempts=0;
						console.log(currentQuestion)
						if (currentQuestion < questionListLength){
							let nextq = questionList[currentQuestion];
							$('#questiontext').text(nextq);
							blink_text();
						}
						else{
								setTimeout(function(){
									$('#questiontext').html('Game Over!');
								}, 250);
							}
					}
					else{
							wrongAttempts++;
							// $('#score').text(myQuiz.correctTally);
							
						}
			    });
			};

		</script>
	</body>
</html>

